<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="node.js node.js是什么   node.js是一个JavaScript运行时环境（即node.js可以解析和执行JavaScript代码）   浏览器中的JavaScript：EcmaScript BOM DOM   node.js只有EcmaScript，没有BOM和DOM   node.js为JavaScript提供一些服务器级别的操作API。例如：文件读写，网络服务的构建，网络通">
<meta name="keywords" content="node">
<meta property="og:type" content="article">
<meta property="og:title" content="node.js入门学习笔记">
<meta property="og:url" content="http://yoursite.com/2019/12/03/node-js入门学习笔记/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="node.js node.js是什么   node.js是一个JavaScript运行时环境（即node.js可以解析和执行JavaScript代码）   浏览器中的JavaScript：EcmaScript BOM DOM   node.js只有EcmaScript，没有BOM和DOM   node.js为JavaScript提供一些服务器级别的操作API。例如：文件读写，网络服务的构建，网络通">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-12-03T02:22:34.076Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="node.js入门学习笔记">
<meta name="twitter:description" content="node.js node.js是什么   node.js是一个JavaScript运行时环境（即node.js可以解析和执行JavaScript代码）   浏览器中的JavaScript：EcmaScript BOM DOM   node.js只有EcmaScript，没有BOM和DOM   node.js为JavaScript提供一些服务器级别的操作API。例如：文件读写，网络服务的构建，网络通">

<link rel="canonical" href="http://yoursite.com/2019/12/03/node-js入门学习笔记/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>node.js入门学习笔记 | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/node-js入门学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          node.js入门学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-12-03 10:19:41 / Modified: 10:22:34" itemprop="dateCreated datePublished" datetime="2019-12-03T10:19:41+08:00">2019-12-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node-js/" itemprop="url" rel="index">
                    <span itemprop="name">node.js</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>node.js</h1>
<h2>node.js是什么</h2>
<ol>
<li>
<p>node.js是一个JavaScript运行时环境（即node.js可以解析和执行JavaScript代码）</p>
</li>
<li>
<p>浏览器中的JavaScript：EcmaScript BOM DOM</p>
</li>
<li>
<p>node.js只有EcmaScript，没有BOM和DOM</p>
</li>
<li>
<p>node.js为JavaScript提供一些服务器级别的操作API。例如：文件读写，网络服务的构建，网络通信，http服务器...</p>
</li>
<li>
<h6><em>JavaScript引擎是一个专门处理JavaScript脚本的虚拟机</em></h6>
</li>
<li>
<p>特点：event-driven（ 事件驱动） non-blocking I/O model （非阻塞IO模型——异步）lightweight and efficient（轻量，高效）</p>
</li>
</ol>
<h2>node.js 能做什么</h2>
<ol>
<li>web服务器后台</li>
<li>命令行工具</li>
</ol>
<h2>核心模块</h2>
<ul>
<li>Node为JavaScript提供了很多服务器级别的API，这些API绝大多数都被包装到一个具名模块中</li>
<li>require是一个方法，作用：</li>
</ul>
<ol>
<li>加载文件模块并执行里面的代码</li>
<li>拿到被加载文件模块导出的接口对象</li>
</ol>
<ul>
<li>在node中模块有三种：</li>
</ul>
<ol>
<li>具名的核心模块</li>
<li>自己编写的文件模块(js文件)</li>
<li>第三方模块</li>
</ol>
<ul>
<li>在node中没有全局作用域，只有模块作用域</li>
</ul>
<h3>常见的核心模块</h3>
<h4>文件操作（fs）</h4>
<ul>
<li>浏览器的JavaScript是没有文件操作能力，但是Node中的JavaScript具有文件操作的能力</li>
<li>fs：file-system</li>
<li>在fs这个核心模块中，提供了所有fs.readFile文件操作相关的API，例如：fs.readFile</li>
<li>fs.readFile:</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">fs.readFile(文件路径，<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">&#125;</span><br><span class="line">            &#125;)<span class="comment">//第一个参数：文件路径，字符串；第二个参数：回调函数</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>fs.writeFile:</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(文件路径,数据,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)<span class="comment">//第一个参数：文件路劲；第二个参数，上传的数据（字符串形式）；第三个参数：回调函数</span></span><br></pre></td></tr></table></figure></p>
<h4>http服务</h4>
<ul>
<li>创建编写服务器</li>
<li>服务器做什么? 提供（对数据的）服务：发请求，接受请求，处理请求，发送响应（反馈）</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> server = http.createServer()<span class="comment">//创建web服务器并返回server实例</span></span><br><span class="line">server.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)<span class="comment">//注册reques请求事件，当客户端请求过来就会自动触发服务器的request请求事件，然后执行第二个参数：回调处理函数</span></span><br><span class="line"><span class="comment">//req 请求参数；res 响应参数</span></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"running"</span>)</span><br><span class="line">&#125;)<span class="comment">//启动服务器，可以用http://127.0.0.1:3000进行访问</span></span><br></pre></td></tr></table></figure></p>
<h2>端口号</h2>
<ul>
<li>ip地址用来定位计算机，端口号用来定位具体的应用程序</li>
<li>所有需要联网通信的软件必须具有端口号</li>
<li>ipconfig 查询本机IP</li>
</ul>
<h2>Contente-Type</h2>
<ul>
<li>在服务器默认发送的数据是utf8编码的内容，中国操作系统默认是gbk</li>
<li>通过网络发送文件，本质上不是在发文件，而是在发送文件内容</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.serHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/plain;charset=utf-8'</span>)</span><br></pre></td></tr></table></figure></p>
<h2>代码规范</h2>
<ul>
<li>JavaScript Standard Style</li>
<li>Airbnb JavaScript Style</li>
<li>采用无分号代码：当一行代码是以<code>(</code> <code>[</code> `开头的时候，要在前面补分号，避免语法错误</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">say()</span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2>在node中使用art-template模板引擎</h2>
<ul>
<li>安装<code>npm i art-template</code></li>
<li>加载模块<code>var template = require('art-template')</code></li>
<li>模板引擎的API <code>var ret = template.render(data.{数据对象})</code></li>
<li><strong>服务端渲染和客户端渲染</strong></li>
</ul>
<ol>
<li>客户端渲染，请求两次。第一次请求页面，第二次请求数据</li>
<li>客户端渲染不利于SEO搜索引擎优化</li>
<li>服务端渲染，请求一次。请求渲染好的页面</li>
<li>服务端渲染是可以被爬虫抓取到的，客户端异步渲染很难被爬虫抓取</li>
<li>真正的网站既不是纯异步也不是纯服务端渲染，而是两者结合</li>
</ol>
<h2>留言本案例</h2>
<h3>文件统一管理——public</h3>
<ul>
<li>public存储所有的静态资源（css，js，img，lib——第三方包）</li>
<li>如果请求路径是以/public/开头的，则意味着是要获取public中的某个资源，直接把请求路径当作文件路径来进行读取</li>
<li>可以通过代码灵活的控制哪些资源是可以被访问的</li>
</ul>
<h3>发表评论——表单提交</h3>
<ul>
<li>表单提交：</li>
</ul>
<ol>
<li>默认的提交行为</li>
<li>表单异步提交</li>
<li>action 表单提交地址——url地址</li>
<li>method 表单提交的方式：get/post</li>
</ol>
<h3>url模块</h3>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">var</span> parseObj = url.parse(req.url,<span class="literal">true</span>)<span class="comment">//两个参数：第一个参数是请求路径，第二个参数是将parseObj.query转为对象</span></span><br><span class="line"><span class="keyword">var</span> pathname = parseObj.pathname<span class="comment">//包含不含查询字符串（？后面的内容）的路径部分</span></span><br></pre></td></tr></table></figure></p>
<h3>用户重定向</h3>
<ol>
<li>状态码设置为302（302为临时重定向）<code>res.statusCode = 302</code></li>
<li>在响应头通过Location告诉客户端往哪里重定向<code>res.setHeader('Location','/')</code></li>
</ol>
<ul>
<li>如果客户端发现服务器响应的状态码是302，就会自动去响应头里找Location</li>
</ul>
<h2>模块化</h2>
<ul>
<li>什么是模块化？</li>
</ul>
<ol>
<li>文件作用域</li>
<li>通信规则（加载、导出）</li>
</ol>
<ul>
<li>CommonJs模块规范</li>
</ul>
<ol>
<li>模块作用域</li>
<li>使用require方法来加载模块</li>
<li>使用export接口对象</li>
</ol>
<ul>
<li>优先从缓冲加载，从而避免重复加载——函数只会执行一次</li>
<li>模块加载机制</li>
</ul>
<p>&lt;img src=&quot;E:\typora\images\TIM图片20191122110249.jpg&quot; style=&quot;zoom:67%;&quot; /&gt;</p>
<h2>npm命令行工具</h2>
<ul>
<li>常见命令</li>
</ul>
<p><code>npm --version</code>  查版本</p>
<p><code>npm install --global npm</code>	全局安装</p>
<p><code>npm init</code> 初始化package.json “dependencies”存放第三包依赖信息</p>
<p><code>npm init -y</code> 跳过向导，快速生成</p>
<p><code>npm instsall</code></p>
<p><code>npm install 包名</code></p>
<p><code>npm install --save</code></p>
<p><em>--save 会保存依赖项信息</em></p>
<p><code>npm uninstall 包名</code> 只删除，如果有依赖项，依然保存</p>
<p><code>npm uninstall --save</code> 删除的同时，删除依赖项信息</p>
<p><code>npm help</code> 查看帮助</p>
<p><code>npm uninstall help</code> 查看指定命令的帮助</p>
<h2>Express</h2>
<p>原生的http在某些方面表现不足</p>
<p>在node中有很多web开发框架</p>
<ol>
<li>安装<code>npm i express --save</code></li>
<li>引包 <code>var express = require('express')</code></li>
</ol>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express()<span class="comment">//创建服务器应用程序（相当于http.createServer)</span></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">'hello express'</span>)</span><br><span class="line">&#125;)<span class="comment">//基本路由</span></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">'running'</span>)</span><br><span class="line">           &#125;)<span class="comment">//监听端口，相当于server.listen</span></span><br><span class="line">app.use(<span class="string">'/public/'</span>,express.static(./public/))<span class="comment">//公开指定目录</span></span><br><span class="line"><span class="comment">//可以通过/public/xx的方式访问public中的所有资源</span></span><br></pre></td></tr></table></figure></p>
<h2>文件路径</h2>
<p>文件操作中的相对路径可以省略<code>./</code></p>
<p>模块加载中，相对路径中的<code>./</code>不可以省略</p>
<h2>nodemon</h2>
<p>基于Node.js开发的第三方命令行工具</p>
<p>安装<code>npm i --global nodemon</code></p>
<p><code>nodemon app.js</code> 监视文件变化，文件发生变化，自动重启服务器</p>
<h2>留言本案例——express改造</h2>
<ol>
<li>安装<code>npm i --save art-template express-art-template</code></li>
<li><code>app.engine('html'require(express-art-template))</code> 当渲染以.html结尾的文件时，使用art-template模板引擎</li>
<li><code>res.render('html模板名'，{模板数据})</code></li>
</ol>
<ul>
<li>Express为response响应对象提供了render方法，render默认是不可以使用的，但是如果配置了模板引擎就可以</li>
<li>若第一个参数不是路径，会去项目的views目录查找模板文件</li>
<li>更改默认<code>app.set('views',目录路径)</code></li>
</ul>
<ol start="4">
<li>重定向<code>res.redirect('/')</code></li>
</ol>
<h3>表单post</h3>
<h4>在express获取表单POST请求体数据</h4>
<ul>
<li>安装body-Parser</li>
<li>引包</li>
<li>配置</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extented</span>:<span class="literal">false</span>&#125;))</span><br><span class="line">app.use(bodyParser.json())</span><br></pre></td></tr></table></figure></p>
<ul>
<li>req.body</li>
</ul>
<h2>crud案例</h2>
<h3>起步</h3>
<ul>
<li>
<p>初始化，模块处理</p>
</li>
<li>
<p>使用Bootstrap的样式</p>
</li>
</ul>
<p><code>app.use('/node_modules',express.static('./node_modules'))</code> 开放node_modules</p>
<h3>路由</h3>
<h4>路由设计</h4>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求路径</th>
<th>get参数</th>
<th>post参数</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/students</td>
<td></td>
<td></td>
<td>渲染首页</td>
</tr>
<tr>
<td>GET</td>
<td>/students/new</td>
<td></td>
<td></td>
<td>渲染添加学生页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/new</td>
<td></td>
<td>name,age,gender,bobbies</td>
<td>处理添加学生请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/edit</td>
<td>id</td>
<td></td>
<td>渲染编辑页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/edit</td>
<td></td>
<td>id,name,age,gender,hobbies</td>
<td>处理编辑清楚</td>
</tr>
<tr>
<td>GET</td>
<td>/students/delete</td>
<td>id</td>
<td></td>
<td>处理删除请求</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4>router.js</h4>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = express.Router()<span class="comment">//创建一个路由容器</span></span><br><span class="line">router.get(<span class="string">'/students'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)//渲染首页</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        students.find(<span class="function"><span class="keyword">function</span>(<span class="params">err,students</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'404 not found'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            res.render(<span class="string">'index.html'</span>,&#123;</span><br><span class="line">                students:students</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">          </span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">router.get()<span class="comment">//其他路由处理</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>.exports = router<span class="comment">//暴露路由</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>app.use(router)</code> 把路由容器挂载到app服务器上</li>
</ul>
<h3>添加学生</h3>
<ol>
<li>表单页面<code>&lt;form action = '/students/new' method = 'POST'&gt;</code></li>
<li>获取表单数据
<ul>
<li>配置bodyParser</li>
</ul>
</li>
<li>处理数据
<ul>
<li>将数据保存到db.json文件用以持久化</li>
<li>读取文件——转为对象——往对象中push数据——把对象转为字符串——字符串写入文件</li>
</ul>
</li>
<li>发送响应--重定向</li>
</ol>
<h4>students.js 数据操作文件模块</h4>
<p>只处理数据，不关心业务</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> dbPath = <span class="string">'./db.json'</span></span><br><span class="line"></span><br><span class="line">exports.save=<span class="function"><span class="keyword">function</span>(<span class="params">student,callback</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//读取学生数据</span></span><br><span class="line">    fs.readFile(dbPath,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将文件字符串转为对象</span></span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="comment">//被添加学生的ID</span></span><br><span class="line">        <span class="keyword">if</span>(students.length==<span class="number">0</span>)&#123;</span><br><span class="line">            student.id = <span class="number">1</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            student.id = students[students.length<span class="number">-1</span>].id+<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//往students对象中添加student</span></span><br><span class="line">        students.push(student)</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            <span class="string">"students"</span> : students</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//数据写入文件</span></span><br><span class="line">        fs.writeFile(dbPath,fileData,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err)</span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p><strong>如果需要获取一个函数中异步操作的结果，则必须通过回调函数</strong></p>
</li>
<li>
<p>回调函数，就是用来获取异步操作的结果</p>
</li>
</ul>
<h3>修改学生信息</h3>
<ol>
<li>在客户端的列表页面中处理链接问题</li>
</ol>
<p><code>&lt;a href='/students/edit?id='&gt;编辑&lt;/a&gt;</code></p>
<ol start="2">
<li>获取需要编辑学生的id</li>
<li>渲染编辑页面</li>
</ol>
<ul>
<li>根据id获取学生信息</li>
<li>使用模板引擎渲染页面</li>
</ul>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染编辑页面</span></span><br><span class="line">exports.findbyId = <span class="function"><span class="keyword">function</span>(<span class="params">id,callback</span>)</span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="keyword">var</span> ret = students.find(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === <span class="built_in">parseInt</span>(id)</span><br><span class="line">            <span class="comment">//id是二进制</span></span><br><span class="line">        &#125;)</span><br><span class="line">        callback(<span class="literal">null</span>,ret)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理编辑信息</span></span><br><span class="line">exports.editById = <span class="function"><span class="keyword">function</span>(<span class="params">student,callback</span>)</span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="comment">//字符串转number</span></span><br><span class="line">        student.id = <span class="built_in">parseInt</span>(student.id)</span><br><span class="line">        <span class="keyword">var</span> stu = students.find(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === student.id</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//循环修改对象属性</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> student)&#123;</span><br><span class="line">            stu[key] = student[key]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//写入文件</span></span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            students:students</span><br><span class="line">        &#125;)</span><br><span class="line">        fs.writeFile(dbPath,fileData,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err)</span><br><span class="line">            &#125;</span><br><span class="line">            callback(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.find(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> item.id === student.id</span><br><span class="line">&#125;)<span class="comment">//ES6d的一个数组方法，接收函数做参数，当满足item.id === student.id时，find停止遍历，同时返回遍历项</span></span><br></pre></td></tr></table></figure></p>
<h3>删除学生</h3>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">exports.deleteById = <span class="function"><span class="keyword">function</span>(<span class="params">id,callback</span>)</span>&#123;</span><br><span class="line">    fs.readFile(dbPath,<span class="string">'utf8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> students = <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">        <span class="keyword">var</span> ret = students.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === id</span><br><span class="line">        &#125;)</span><br><span class="line">        students.splice(ret,<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            students:students</span><br><span class="line">        &#125;)</span><br><span class="line">        fs.writeFile(dbPath,fileData,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err)</span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret = students.findIndex(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item.id === id</span><br><span class="line">        &#125;)<span class="comment">//同find，返回下标</span></span><br></pre></td></tr></table></figure></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/node/" rel="tag"># node</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/03/图解HTTP学习笔记/" rel="prev" title="图解HTTP学习笔记">
      <i class="fa fa-chevron-left"></i> 图解HTTP学习笔记
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-number">1.</span> <span class="nav-text">node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.1.</span> <span class="nav-text">node.js是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#null"><span class="nav-number">1.1.0.0.0.1.</span> <span class="nav-text">JavaScript引擎是一个专门处理JavaScript脚本的虚拟机</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.2.</span> <span class="nav-text">node.js 能做什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.3.</span> <span class="nav-text">核心模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.3.1.</span> <span class="nav-text">常见的核心模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">文件操作（fs）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">http服务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.4.</span> <span class="nav-text">端口号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.5.</span> <span class="nav-text">Contente-Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.6.</span> <span class="nav-text">代码规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.7.</span> <span class="nav-text">在node中使用art-template模板引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.8.</span> <span class="nav-text">留言本案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.8.1.</span> <span class="nav-text">文件统一管理——public</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.8.2.</span> <span class="nav-text">发表评论——表单提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.8.3.</span> <span class="nav-text">url模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.8.4.</span> <span class="nav-text">用户重定向</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.9.</span> <span class="nav-text">模块化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.10.</span> <span class="nav-text">npm命令行工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.11.</span> <span class="nav-text">Express</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.12.</span> <span class="nav-text">文件路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.13.</span> <span class="nav-text">nodemon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.14.</span> <span class="nav-text">留言本案例——express改造</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.14.1.</span> <span class="nav-text">表单post</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.14.1.1.</span> <span class="nav-text">在express获取表单POST请求体数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.15.</span> <span class="nav-text">crud案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.15.1.</span> <span class="nav-text">起步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.15.2.</span> <span class="nav-text">路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.15.2.1.</span> <span class="nav-text">路由设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.15.2.2.</span> <span class="nav-text">router.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.15.3.</span> <span class="nav-text">添加学生</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.15.3.1.</span> <span class="nav-text">students.js 数据操作文件模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.15.4.</span> <span class="nav-text">修改学生信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.15.5.</span> <span class="nav-text">删除学生</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
